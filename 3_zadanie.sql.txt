-- Задание 3.1: Количество исполнителей по жанрам
SELECT g.name AS название_жанра, COUNT(ag.artist_id) AS количество_исполнителей
FROM genres g
LEFT JOIN artist_genre ag ON g.id = ag.genre_id
GROUP BY g.id, g.name
ORDER BY количество_исполнителей DESC;

-- Задание 3.2: Количество треков 2019-2020 гг.
SELECT COUNT(t.id) AS количество_треков
FROM tracks t
JOIN albums a ON t.album_id = a.id
WHERE a.release_year BETWEEN 2019 AND 2020;

-- Задание 3.3: Средняя длительность треков по альбомам
SELECT a.title AS название_альбома,
       ROUND(AVG(t.duration), 2) AS средняя_длительность,
       CONCAT(FLOOR(AVG(t.duration)/60), ':', LPAD(MOD(AVG(t.duration), 60), 2, '0')) AS средняя_длительность_мм_сс
FROM albums a
JOIN tracks t ON a.id = t.album_id
GROUP BY a.id, a.title
ORDER BY средняя_длительность DESC;

-- Задание 3.4: Исполнители без альбомов 2020 г.
SELECT DISTINCT ar.name AS имя
FROM artists ar
WHERE ar.id NOT IN (
    SELECT DISTINCT aa.artist_id
    FROM artist_album aa
    JOIN albums al ON aa.album_id = al.id
    WHERE al.release_year = 2020
)
ORDER BY ar.name;
-- Пример результата: Eminem (если нет альбомов 2020)

-- Задание 3.5: Сборники с Eminem
SELECT DISTINCT c.title AS название, c.release_year AS год_выпуска
FROM compilations c
JOIN compilation_track ct ON c.id = ct.compilation_id
JOIN tracks t ON ct.track_id = t.id
JOIN albums a ON t.album_id = a.id
JOIN artist_album aa ON a.id = aa.album_id
JOIN artists ar ON aa.artist_id = ar.id
WHERE ar.name = 'Eminem'
ORDER BY c.release_year;
